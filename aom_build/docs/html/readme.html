<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>AOMedia Codec SDK: README.md</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AOMedia Codec SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README.md </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="fragment"><div class="line"># AV1 Codec Library</div><div class="line"></div><div class="line">## Contents</div><div class="line">1. [Building the lib and applications](#building-the-library-and-applications)</div><div class="line">    - [Prerequisites](#prerequisites)</div><div class="line">    - [Get the code](#get-the-code)</div><div class="line">    - [Basics](#basic-build)</div><div class="line">    - [Configuration options](#configuration-options)</div><div class="line">    - [Dylib builds](#dylib-builds)</div><div class="line">    - [Debugging](#debugging)</div><div class="line">    - [Cross compiling](#cross-compiling)</div><div class="line">    - [Sanitizer support](#sanitizers)</div><div class="line">    - [MSVC builds](#microsoft-visual-studio-builds)</div><div class="line">    - [Xcode builds](#xcode-builds)</div><div class="line">    - [Emscripten builds](#emscripten-builds)</div><div class="line">    - [Extra Build Flags](#extra-build-flags)</div><div class="line">2. [Testing the library](#testing-the-av1-codec)</div><div class="line">    - [Basics](#testing-basics)</div><div class="line">        - [Unit tests](#1_unit-tests)</div><div class="line">        - [Example tests](#2_example-tests)</div><div class="line">        - [Encoder tests](#3_encoder-tests)</div><div class="line">    - [IDE hosted tests](#ide-hosted-tests)</div><div class="line">    - [Downloading test data](#downloading-the-test-data)</div><div class="line">    - [Adding a new test data file](#adding-a-new-test-data-file)</div><div class="line">    - [Additional test data](#additional-test-data)</div><div class="line">    - [Sharded testing](#sharded-testing)</div><div class="line">        - [Running tests directly](#1_running-test_libaom-directly)</div><div class="line">        - [Running tests via CMake](#2_running-the-tests-via-the-cmake-build)</div><div class="line">3. [Coding style](#coding-style)</div><div class="line">4. [Submitting patches](#submitting-patches)</div><div class="line">    - [Login cookie](#login-cookie)</div><div class="line">    - [Contributor agreement](#contributor-agreement)</div><div class="line">    - [Testing your code](#testing-your-code)</div><div class="line">    - [Commit message hook](#commit-message-hook)</div><div class="line">    - [Upload your change](#upload-your-change)</div><div class="line">    - [Incorporating Reviewer Comments](#incorporating-reviewer-comments)</div><div class="line">    - [Submitting your change](#submitting-your-change)</div><div class="line">    - [Viewing change status](#viewing-the-status-of-uploaded-changes)</div><div class="line">5. [Support](#support)</div><div class="line">6. [Bug reports](#bug-reports)</div><div class="line"></div><div class="line">## Building the library and applications</div><div class="line"></div><div class="line">### Prerequisites</div><div class="line"></div><div class="line"> 1. [CMake](https://cmake.org) version 3.5 or higher.</div><div class="line"> 2. [Git](https://git-scm.com/).</div><div class="line"> 3. [Perl](https://www.perl.org/).</div><div class="line"> 4. For x86 targets, [yasm](http://yasm.tortall.net/), which is preferred, or a</div><div class="line">    recent version of [nasm](http://www.nasm.us/).</div><div class="line"> 5. Building the documentation requires [doxygen](http://doxygen.org).</div><div class="line"> 6. Building the unit tests requires [Python](https://www.python.org/).</div><div class="line"> 7. Emscripten builds require the portable</div><div class="line">   [EMSDK](https://kripken.github.io/emscripten-site/index.html).</div><div class="line"></div><div class="line">### Get the code</div><div class="line"></div><div class="line">The AV1 library source code is stored in the Alliance for Open Media Git</div><div class="line">repository:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ git clone https://aomedia.googlesource.com/aom</div><div class="line">    # By default, the above command stores the source in the aom directory:</div><div class="line">    $ cd aom</div><div class="line">~~~</div><div class="line"></div><div class="line">### Basic build</div><div class="line"></div><div class="line">CMake replaces the configure step typical of many projects. Running CMake will</div><div class="line">produce configuration and build files for the currently selected CMake</div><div class="line">generator. For most systems the default generator is Unix Makefiles. The basic</div><div class="line">form of a makefile build is the following:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom</div><div class="line">    $ make</div><div class="line">~~~</div><div class="line"></div><div class="line">The above will generate a makefile build that produces the AV1 library and</div><div class="line">applications for the current host system after the make step completes</div><div class="line">successfully. The compiler chosen varies by host platform, but a general rule</div><div class="line">applies: On systems where cc and c++ are present in $PATH at the time CMake is</div><div class="line">run the generated build will use cc and c++ by default.</div><div class="line"></div><div class="line">### Configuration options</div><div class="line"></div><div class="line">The AV1 codec library has a great many configuration options. These come in two</div><div class="line">varieties:</div><div class="line"></div><div class="line"> 1. Build system configuration options. These have the form `ENABLE_FEATURE`.</div><div class="line"> 2. AV1 codec configuration options. These have the form `CONFIG_FEATURE`.</div><div class="line"></div><div class="line">Both types of options are set at the time CMake is run. The following example</div><div class="line">enables ccache and disables the AV1 encoder:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -DENABLE_CCACHE=1 -DCONFIG_AV1_ENCODER=0</div><div class="line">    $ make</div><div class="line">~~~</div><div class="line"></div><div class="line">The available configuration options are too numerous to list here. Build system</div><div class="line">configuration options can be found at the top of the CMakeLists.txt file found</div><div class="line">in the root of the AV1 repository, and AV1 codec configuration options can</div><div class="line">currently be found in the file `build/cmake/aom_config_defaults.cmake`.</div><div class="line"></div><div class="line">### Dylib builds</div><div class="line"></div><div class="line">A dylib (shared object) build of the AV1 codec library can be enabled via the</div><div class="line">CMake built in variable `BUILD_SHARED_LIBS`:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -DBUILD_SHARED_LIBS=1</div><div class="line">    $ make</div><div class="line">~~~</div><div class="line"></div><div class="line">This is currently only supported on non-Windows targets.</div><div class="line"></div><div class="line">### Debugging</div><div class="line"></div><div class="line">Depending on the generator used there are multiple ways of going about</div><div class="line">debugging AV1 components. For single configuration generators like the Unix</div><div class="line">Makefiles generator, setting `CMAKE_BUILD_TYPE` to Debug is sufficient:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -DCMAKE_BUILD_TYPE=Debug</div><div class="line">~~~</div><div class="line"></div><div class="line">For Xcode, mainly because configuration controls for Xcode builds are buried two</div><div class="line">configuration windows deep and must be set for each subproject within the Xcode</div><div class="line">IDE individually, `CMAKE_CONFIGURATION_TYPES` should be set to Debug:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -G Xcode -DCMAKE_CONFIGURATION_TYPES=Debug</div><div class="line">~~~</div><div class="line"></div><div class="line">For Visual Studio the in-IDE configuration controls should be used. Simply set</div><div class="line">the IDE project configuration to Debug to allow for stepping through the code.</div><div class="line"></div><div class="line">In addition to the above it can sometimes be useful to debug only C and C++</div><div class="line">code. To disable all assembly code and intrinsics set `AOM_TARGET_CPU` to</div><div class="line">generic at generation time:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -DAOM_TARGET_CPU=generic</div><div class="line">~~~</div><div class="line"></div><div class="line">### Cross compiling</div><div class="line"></div><div class="line">For the purposes of building the AV1 codec and applications and relative to the</div><div class="line">scope of this guide, all builds for architectures differing from the native host</div><div class="line">architecture will be considered cross compiles. The AV1 CMake build handles</div><div class="line">cross compiling via the use of toolchain files included in the AV1 repository.</div><div class="line">The toolchain files available at the time of this writing are:</div><div class="line"></div><div class="line"> - arm64-ios.cmake</div><div class="line"> - arm64-linux-gcc.cmake</div><div class="line"> - arm64-mingw-gcc.cmake</div><div class="line"> - armv7-ios.cmake</div><div class="line"> - armv7-linux-gcc.cmake</div><div class="line"> - armv7-mingw-gcc.cmake</div><div class="line"> - armv7s-ios.cmake</div><div class="line"> - mips32-linux-gcc.cmake</div><div class="line"> - mips64-linux-gcc.cmake</div><div class="line"> - x86-ios-simulator.cmake</div><div class="line"> - x86-linux.cmake</div><div class="line"> - x86-macos.cmake</div><div class="line"> - x86-mingw-gcc.cmake</div><div class="line"> - x86\_64-ios-simulator.cmake</div><div class="line"> - x86\_64-mingw-gcc.cmake</div><div class="line"></div><div class="line">The following example demonstrates use of the x86-macos.cmake toolchain file on</div><div class="line">a x86\_64 MacOS host:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom \</div><div class="line">      -DCMAKE_TOOLCHAIN_FILE=path/to/aom/build/cmake/toolchains/x86-macos.cmake</div><div class="line">    $ make</div><div class="line">~~~</div><div class="line"></div><div class="line">To build for an unlisted target creation of a new toolchain file is the best</div><div class="line">solution. The existing toolchain files can be used a starting point for a new</div><div class="line">toolchain file since each one exposes the basic requirements for toolchain files</div><div class="line">as used in the AV1 codec build.</div><div class="line"></div><div class="line">As a temporary work around an unoptimized AV1 configuration that builds only C</div><div class="line">and C++ sources can be produced using the following commands:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -DAOM_TARGET_CPU=generic</div><div class="line">    $ make</div><div class="line">~~~</div><div class="line"></div><div class="line">In addition to the above it&#39;s important to note that the toolchain files</div><div class="line">suffixed with gcc behave differently than the others. These toolchain files</div><div class="line">attempt to obey the $CROSS environment variable.</div><div class="line"></div><div class="line">### Sanitizers</div><div class="line"></div><div class="line">Sanitizer integration is built-in to the CMake build system. To enable a</div><div class="line">sanitizer, add `-DSANITIZE=&lt;type&gt;` to the CMake command line. For example, to</div><div class="line">enable address sanitizer:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -DSANITIZE=address</div><div class="line">    $ make</div><div class="line">~~~</div><div class="line"></div><div class="line">Sanitizers available vary by platform, target, and compiler. Consult your</div><div class="line">compiler documentation to determine which, if any, are available.</div><div class="line"></div><div class="line">### Microsoft Visual Studio builds</div><div class="line"></div><div class="line">Building the AV1 codec library in Microsoft Visual Studio is supported. Visual</div><div class="line">Studio 2015 (14.0) or later is required. The following example demonstrates</div><div class="line">generating projects and a solution for the Microsoft IDE:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # This does not require a bash shell; command.exe is fine.</div><div class="line">    $ cmake path/to/aom -G &quot;Visual Studio 15 2017&quot;</div><div class="line">~~~</div><div class="line"></div><div class="line">NOTE: The build system targets Windows 7 or later by compiling files with</div><div class="line">`-D_WIN32_WINNT=0x0601`.</div><div class="line"></div><div class="line">### Xcode builds</div><div class="line"></div><div class="line">Building the AV1 codec library in Xcode is supported. The following example</div><div class="line">demonstrates generating an Xcode project:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -G Xcode</div><div class="line">~~~</div><div class="line"></div><div class="line">### Emscripten builds</div><div class="line"></div><div class="line">Building the AV1 codec library with Emscripten is supported. Typically this is</div><div class="line">used to hook into the AOMAnalyzer GUI application. These instructions focus on</div><div class="line">using the inspector with AOMAnalyzer, but all tools can be built with</div><div class="line">Emscripten.</div><div class="line"></div><div class="line">It is assumed here that you have already downloaded and installed the EMSDK,</div><div class="line">installed and activated at least one toolchain, and setup your environment</div><div class="line">appropriately using the emsdk\_env script.</div><div class="line"></div><div class="line">1. Download [AOMAnalyzer](https://people.xiph.org/~mbebenita/analyzer/).</div><div class="line"></div><div class="line">2. Configure the build:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom \</div><div class="line">        -DENABLE_CCACHE=1 \</div><div class="line">        -DAOM_TARGET_CPU=generic \</div><div class="line">        -DENABLE_DOCS=0 \</div><div class="line">        -DENABLE_TESTS=0 \</div><div class="line">        -DCONFIG_ACCOUNTING=1 \</div><div class="line">        -DCONFIG_INSPECTION=1 \</div><div class="line">        -DCONFIG_MULTITHREAD=0 \</div><div class="line">        -DCONFIG_RUNTIME_CPU_DETECT=0 \</div><div class="line">        -DCONFIG_WEBM_IO=0 \</div><div class="line">        -DCMAKE_TOOLCHAIN_FILE=path/to/emsdk-portable/.../Emscripten.cmake</div><div class="line">~~~</div><div class="line"></div><div class="line">3. Build it: run make if that&#39;s your generator of choice:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ make inspect</div><div class="line">~~~</div><div class="line"></div><div class="line">4. Run the analyzer:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # inspect.js is in the examples sub directory of the directory in which you</div><div class="line">    # executed cmake.</div><div class="line">    $ path/to/AOMAnalyzer path/to/examples/inspect.js path/to/av1/input/file</div><div class="line">~~~</div><div class="line"></div><div class="line">### Extra build flags</div><div class="line"></div><div class="line">Three variables allow for passing of additional flags to the build system.</div><div class="line"></div><div class="line">- AOM\_EXTRA\_C\_FLAGS</div><div class="line">- AOM\_EXTRA\_CXX\_FLAGS</div><div class="line">- AOM\_EXTRA\_EXE\_LINKER\_FLAGS</div><div class="line"></div><div class="line">The build system attempts to ensure the flags passed through the above variables</div><div class="line">are passed to tools last in order to allow for override of default behavior.</div><div class="line">These flags can be used, for example, to enable asserts in a release build:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom \</div><div class="line">        -DCMAKE_BUILD_TYPE=Release \</div><div class="line">        -DAOM_EXTRA_C_FLAGS=-UNDEBUG \</div><div class="line">        -DAOM_EXTRA_CXX_FLAGS=-UNDEBUG</div><div class="line">~~~</div><div class="line"></div><div class="line">## Testing the AV1 codec</div><div class="line"></div><div class="line">### Testing basics</div><div class="line"></div><div class="line">There are several methods of testing the AV1 codec. All of these methods require</div><div class="line">the presence of the AV1 source code and a working build of the AV1 library and</div><div class="line">applications.</div><div class="line"></div><div class="line">#### 1. Unit tests:</div><div class="line"></div><div class="line">The unit tests can be run at build time:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # Before running the make command the LIBAOM_TEST_DATA_PATH environment</div><div class="line">    # variable should be set to avoid downloading the test files to the</div><div class="line">    # cmake build configuration directory.</div><div class="line">    $ cmake path/to/aom</div><div class="line">    # Note: The AV1 CMake build creates many test targets. Running make</div><div class="line">    # with multiple jobs will speed up the test run significantly.</div><div class="line">    $ make runtests</div><div class="line">~~~</div><div class="line"></div><div class="line">#### 2. Example tests:</div><div class="line"></div><div class="line">The example tests require a bash shell and can be run in the following manner:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # See the note above about LIBAOM_TEST_DATA_PATH above.</div><div class="line">    $ cmake path/to/aom</div><div class="line">    $ make</div><div class="line">    # It&#39;s best to build the testdata target using many make jobs.</div><div class="line">    # Running it like this will verify and download (if necessary)</div><div class="line">    # one at a time, which takes a while.</div><div class="line">    $ make testdata</div><div class="line">    $ path/to/aom/test/examples.sh --bin-path examples</div><div class="line">~~~</div><div class="line"></div><div class="line">#### 3. Encoder tests:</div><div class="line"></div><div class="line">When making a change to the encoder run encoder tests to confirm that your</div><div class="line">change has a positive or negligible impact on encode quality. When running these</div><div class="line">tests the build configuration should be changed to enable internal encoder</div><div class="line">statistics:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -DCONFIG_INTERNAL_STATS=1</div><div class="line">    $ make</div><div class="line">~~~</div><div class="line"></div><div class="line">The repository contains scripts intended to make running these tests as simple</div><div class="line">as possible. The following example demonstrates creating a set of baseline clips</div><div class="line">for comparison to results produced after making your change to libaom:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # This will encode all Y4M files in the current directory using the</div><div class="line">    # settings specified to create the encoder baseline statistical data:</div><div class="line">    $ cd path/to/test/inputs</div><div class="line">    # This command line assumes that run_encodes.sh, its helper script</div><div class="line">    # best_encode.sh, and the aomenc you intend to test are all within a</div><div class="line">    # directory in your PATH.</div><div class="line">    $ run_encodes.sh 200 500 50 baseline</div><div class="line">~~~</div><div class="line"></div><div class="line">After making your change and creating the baseline clips, you&#39;ll need to run</div><div class="line">encodes that include your change(s) to confirm that things are working as</div><div class="line">intended:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # This will encode all Y4M files in the current directory using the</div><div class="line">    # settings specified to create the statistical data for your change:</div><div class="line">    $ cd path/to/test/inputs</div><div class="line">    # This command line assumes that run_encodes.sh, its helper script</div><div class="line">    # best_encode.sh, and the aomenc you intend to test are all within a</div><div class="line">    # directory in your PATH.</div><div class="line">    $ run_encodes.sh 200 500 50 mytweak</div><div class="line">~~~</div><div class="line"></div><div class="line">After creating both data sets you can use `test/visual_metrics.py` to generate a</div><div class="line">report that can be viewed in a web browser:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ visual_metrics.py metrics_template.html &quot;*stt&quot; baseline mytweak \</div><div class="line">      &gt; mytweak.html</div><div class="line">~~~</div><div class="line"></div><div class="line">You can view the report by opening mytweak.html in a web browser.</div><div class="line"></div><div class="line"></div><div class="line">### IDE hosted tests</div><div class="line"></div><div class="line">By default the generated projects files created by CMake will not include the</div><div class="line">runtests and testdata rules when generating for IDEs like Microsoft Visual</div><div class="line">Studio and Xcode. This is done to avoid intolerably long build cycles in the</div><div class="line">IDEs-- IDE behavior is to build all targets when selecting the build project</div><div class="line">options in MSVS and Xcode. To enable the test rules in IDEs the</div><div class="line">`ENABLE_IDE_TEST_HOSTING` variable must be enabled at CMake generation time:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # This example uses Xcode. To get a list of the generators</div><div class="line">    # available, run cmake with the -G argument missing its</div><div class="line">    # value.</div><div class="line">    $ cmake path/to/aom -DENABLE_IDE_TEST_HOSTING=1 -G Xcode</div><div class="line">~~~</div><div class="line"></div><div class="line">### Downloading the test data</div><div class="line"></div><div class="line">The fastest and easiest way to obtain the test data is to use CMake to generate</div><div class="line">a build using the Unix Makefiles generator, and then to build only the testdata</div><div class="line">rule:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ cmake path/to/aom -G &quot;Unix Makefiles&quot;</div><div class="line">    # 28 is used because there are 28 test files as of this writing.</div><div class="line">    $ make -j28 testdata</div><div class="line">~~~</div><div class="line"></div><div class="line">The above make command will only download and verify the test data.</div><div class="line"></div><div class="line">### Adding a new test data file</div><div class="line"></div><div class="line">First, add the new test data file to the `aom-test-data` bucket of the</div><div class="line">`aomedia-testing` project on Google Cloud Platform. You may need to ask someone</div><div class="line">with the necessary access permissions to do this for you.</div><div class="line"></div><div class="line">NOTE: When a new test data file is added to the `aom-test-data` bucket, its</div><div class="line">&quot;Public access&quot; is initially &quot;Not public&quot;. We need to change its</div><div class="line">&quot;Public access&quot; to &quot;Public&quot; by using the following</div><div class="line">[`gsutil`](https://cloud.google.com/storage/docs/gsutil_install) command:</div><div class="line">~~~</div><div class="line">    $ gsutil acl ch -g all:R gs://aom-test-data/test-data-file-name</div><div class="line">~~~</div><div class="line">This command grants the `AllUsers` group READ access to the file named</div><div class="line">&quot;test-data-file-name&quot; in the `aom-test-data` bucket.</div><div class="line"></div><div class="line">Once the new test data file has been added to `aom-test-data`, create a CL to</div><div class="line">add the name of the new test data file to `test/test_data_util.cmake` and add</div><div class="line">the SHA1 checksum of the new test data file to `test/test-data.sha1`. (The SHA1</div><div class="line">checksum of a file can be calculated by running the `sha1sum` command on the</div><div class="line">file.)</div><div class="line"></div><div class="line">### Additional test data</div><div class="line"></div><div class="line">The test data mentioned above is strictly intended for unit testing.</div><div class="line"></div><div class="line">Additional input data for testing the encoder can be obtained from:</div><div class="line">https://media.xiph.org/video/derf/</div><div class="line"></div><div class="line">### Sharded testing</div><div class="line"></div><div class="line">The AV1 codec library unit tests are built upon gtest which supports sharding of</div><div class="line">test jobs. Sharded test runs can be achieved in a couple of ways.</div><div class="line"></div><div class="line">#### 1. Running test\_libaom directly:</div><div class="line"></div><div class="line">~~~</div><div class="line">   # Set the environment variable GTEST_TOTAL_SHARDS to control the number of</div><div class="line">   # shards.</div><div class="line">   $ export GTEST_TOTAL_SHARDS=10</div><div class="line">   # (GTEST shard indexing is 0 based).</div><div class="line">   $ seq 0 $(( $GTEST_TOTAL_SHARDS - 1 )) \</div><div class="line">       | xargs -n 1 -P 0 -I{} env GTEST_SHARD_INDEX={} ./test_libaom</div><div class="line">~~~</div><div class="line"></div><div class="line">To create a test shard for each CPU core available on the current system set</div><div class="line">`GTEST_TOTAL_SHARDS` to the number of CPU cores on your system minus one.</div><div class="line"></div><div class="line">#### 2. Running the tests via the CMake build:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # For IDE based builds, ENABLE_IDE_TEST_HOSTING must be enabled. See</div><div class="line">    # the IDE hosted tests section above for more information. If the IDE</div><div class="line">    # supports building targets concurrently tests will be sharded by default.</div><div class="line"></div><div class="line">    # For make and ninja builds the -j parameter controls the number of shards</div><div class="line">    # at test run time. This example will run the tests using 10 shards via</div><div class="line">    # make.</div><div class="line">    $ make -j10 runtests</div><div class="line">~~~</div><div class="line"></div><div class="line">The maximum number of test targets that can run concurrently is determined by</div><div class="line">the number of CPUs on the system where the build is configured as detected by</div><div class="line">CMake. A system with 24 cores can run 24 test shards using a value of 24 with</div><div class="line">the `-j` parameter. When CMake is unable to detect the number of cores 10 shards</div><div class="line">is the default maximum value.</div><div class="line"></div><div class="line">## Coding style</div><div class="line"></div><div class="line">We are using the Google C Coding Style defined by the</div><div class="line">[Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html).</div><div class="line"></div><div class="line">The coding style used by this project is enforced with clang-format using the</div><div class="line">configuration contained in the</div><div class="line">[.clang-format](https://chromium.googlesource.com/webm/aom/+/master/.clang-format)</div><div class="line">file in the root of the repository.</div><div class="line"></div><div class="line">You can download clang-format using your system&#39;s package manager, or directly</div><div class="line">from [llvm.org](http://llvm.org/releases/download.html). You can also view the</div><div class="line">[documentation](https://clang.llvm.org/docs/ClangFormat.html) on llvm.org.</div><div class="line">Output from clang-format varies by clang-format version, for best results your</div><div class="line">version should match the one used on Jenkins. You can find the clang-format</div><div class="line">version by reading the comment in the `.clang-format` file linked above.</div><div class="line"></div><div class="line">Before pushing changes for review you can format your code with:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # Apply clang-format to modified .c, .h and .cc files</div><div class="line">    $ clang-format -i --style=file \</div><div class="line">      $(git diff --name-only --diff-filter=ACMR &#39;*.[hc]&#39; &#39;*.cc&#39;)</div><div class="line">~~~</div><div class="line"></div><div class="line">Check the .clang-format file for the version used to generate it if there is any</div><div class="line">difference between your local formatting and the review system.</div><div class="line"></div><div class="line">Some Git installations have clang-format integration. Here are some examples:</div><div class="line"></div><div class="line">~~~</div><div class="line">    # Apply clang-format to all staged changes:</div><div class="line">    $ git clang-format</div><div class="line"></div><div class="line">    # Clang format all staged and unstaged changes:</div><div class="line">    $ git clang-format -f</div><div class="line"></div><div class="line">    # Clang format all staged and unstaged changes interactively:</div><div class="line">    $ git clang-format -f -p</div><div class="line">~~~</div><div class="line"></div><div class="line">## Submitting patches</div><div class="line"></div><div class="line">We manage the submission of patches using the</div><div class="line">[Gerrit](https://www.gerritcodereview.com/) code review tool. This tool</div><div class="line">implements a workflow on top of the Git version control system to ensure that</div><div class="line">all changes get peer reviewed and tested prior to their distribution.</div><div class="line"></div><div class="line">### Login cookie</div><div class="line"></div><div class="line">Browse to [AOMedia Git index](https://aomedia.googlesource.com/) and login with</div><div class="line">your account (Gmail credentials, for example). Next, follow the</div><div class="line">`Generate Password` Password link at the top of the page. You’ll be given</div><div class="line">instructions for creating a cookie to use with our Git repos.</div><div class="line"></div><div class="line">### Contributor agreement</div><div class="line"></div><div class="line">You will be required to execute a</div><div class="line">[contributor agreement](http://aomedia.org/license) to ensure that the AOMedia</div><div class="line">Project has the right to distribute your changes.</div><div class="line"></div><div class="line">### Testing your code</div><div class="line"></div><div class="line">The testing basics are covered in the [testing section](#testing-the-av1-codec)</div><div class="line">above.</div><div class="line"></div><div class="line">In addition to the local tests, many more (e.g. asan, tsan, valgrind) will run</div><div class="line">through Jenkins instances upon upload to gerrit.</div><div class="line"></div><div class="line">### Commit message hook</div><div class="line"></div><div class="line">Gerrit requires that each submission include a unique Change-Id. You can assign</div><div class="line">one manually using git commit --amend, but it’s easier to automate it with the</div><div class="line">commit-msg hook provided by Gerrit.</div><div class="line"></div><div class="line">Copy commit-msg to the `.git/hooks` directory of your local repo. Here&#39;s an</div><div class="line">example:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ curl -Lo aom/.git/hooks/commit-msg https://chromium-review.googlesource.com/tools/hooks/commit-msg</div><div class="line"></div><div class="line">    # Next, ensure that the downloaded commit-msg script is executable:</div><div class="line">    $ chmod u+x aom/.git/hooks/commit-msg</div><div class="line">~~~</div><div class="line"></div><div class="line">See the Gerrit</div><div class="line">[documentation](https://gerrit-review.googlesource.com/Documentation/user-changeid.html)</div><div class="line">for more information.</div><div class="line"></div><div class="line">### Upload your change</div><div class="line"></div><div class="line">The command line to upload your patch looks like this:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ git push https://aomedia-review.googlesource.com/aom HEAD:refs/for/master</div><div class="line">~~~</div><div class="line"></div><div class="line">### Incorporating reviewer comments</div><div class="line"></div><div class="line">If you previously uploaded a change to Gerrit and the Approver has asked for</div><div class="line">changes, follow these steps:</div><div class="line"></div><div class="line">1. Edit the files to make the changes the reviewer has requested.</div><div class="line">2. Recommit your edits using the --amend flag, for example:</div><div class="line"></div><div class="line">~~~</div><div class="line">   $ git commit -a --amend</div><div class="line">~~~</div><div class="line"></div><div class="line">3. Use the same git push command as above to upload to Gerrit again for another</div><div class="line">   review cycle.</div><div class="line"></div><div class="line">In general, you should not rebase your changes when doing updates in response to</div><div class="line">review. Doing so can make it harder to follow the evolution of your change in</div><div class="line">the diff view.</div><div class="line"></div><div class="line">### Submitting your change</div><div class="line"></div><div class="line">Once your change has been Approved and Verified, you can “submit” it through the</div><div class="line">Gerrit UI. This will usually automatically rebase your change onto the branch</div><div class="line">specified.</div><div class="line"></div><div class="line">Sometimes this can’t be done automatically. If you run into this problem, you</div><div class="line">must rebase your changes manually:</div><div class="line"></div><div class="line">~~~</div><div class="line">    $ git fetch</div><div class="line">    $ git rebase origin/branchname</div><div class="line">~~~</div><div class="line"></div><div class="line">If there are any conflicts, resolve them as you normally would with Git. When</div><div class="line">you’re done, reupload your change.</div><div class="line"></div><div class="line">### Viewing the status of uploaded changes</div><div class="line"></div><div class="line">To check the status of a change that you uploaded, open</div><div class="line">[Gerrit](https://aomedia-review.googlesource.com/), sign in, and click My &gt;</div><div class="line">Changes.</div><div class="line"></div><div class="line">## Support</div><div class="line"></div><div class="line">This library is an open source project supported by its community. Please</div><div class="line">please email aomediacodec@jointdevelopment.kavi.com for help.</div><div class="line"></div><div class="line">## Bug reports</div><div class="line"></div><div class="line">Bug reports can be filed in the Alliance for Open Media</div><div class="line">[issue tracker](https://bugs.chromium.org/p/aomedia/issues/list).</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
